# 数据链路层

## 概念

* 数据链路层使用的信道:
  * 点对点信道:主线 独占 广域网
  * 广播信道:一对多 共享 局域网
* 点对点信道
  1. 链路:一条无源的点到点的物理线路,中间没有其他节点
  2. 数据链路:包括通信协议和物理链路
  3. 协议面对的三个基本问题:
     1. **将数据封装成帧**,帧是数据链路层的基本传送单元,对数据添加帧首(以控制字符SOH开始)和帧尾(以控制字符EOF结束)
     2. **透明传输**,由于数据部分也有可能使用控制字符,因此透明传输意味着无论数据如何,都能无差错通过数据链路层,为此需要在数据中存在的控制字符前添加转义字符ESC,这种方法被称为字符填充
     3. **差错检验**,现实中,比特在传输过程中可能产生差错,而在一段时间内出错比特占传输比特总数的比率称为**误码率BER**,与信噪比有关,目前广泛采用循环冗余检验进行差错检验
  4. **循环冗余检验(CRC)**:设发送长度为n的数据流,在发送前,信号发送方选择一个二进制数对数据流进行取模运算,将取模结果和二进制数一同发给接收方,接收方重新计算,查看结果是否一致,如果一致,则认为无差错,否则认为有差错,丢弃
* **点对点协议PPP**:
  * 特点:
    1️⃣需求简单,封装成帧;
    2️⃣透明性(见上),同时支持多种网络协议;
    3️⃣存在差错检测,能在多种类型的链路(串行并行,高速低速等)上运行
    4️⃣会检查连接状态和最大传送单元(信息部分的最大长度,默认为1500),会进行网络层地址协商
  * 点对点协议不存在纠错功能,流量控制,序号标记,半双工/单工链路
  * PPP协议由封装IP数据报(信息部分)的方法,LCP链路控制,NCP网络控制组成
  * ppp的帧格式

  |首部||||IP数据报(不超过1500字节)|尾部||
  |---|---|---|---|---|---|---|
  |7E|FF|03|控制协议|信息部分|FCS|7E|

  * 透明性保证:若出现`0X7E(0b01111110)`将其替换
    * 字节填充:将`0X7E`转换成`0X7D 0X5E`,将正常的`0X7D`转换成`0X7D 0X23`
    * 零比特填充:若信息中出现连续的5个1则在后面加入一个0,防止出现`0X7E`
  * ppp的工作过程:
    1. 拨号,接入ISP服务商,确认后建立物理连接
    2. pc机向路由器发送ISP分组请求,选择PPP参数,并进行网络层的配置
    3. NCP将接入的pc分配临时IP地址,PC机连上互联网
    4. 通信完毕,NCP释放连接,回收IP地址
    5. LCP释放数据链路连接
    6. 释放物理连接
* **局域网的数据链路层**
* 一个单位所拥有的地理范围,站点数目均有限,曾经使用总线结构和环形结构进行连接,现使用星形结构和大型交换机双绞线连接主机
* 媒体共享技术
  * 静态划分信道:FDM,TDM,WDM,CDM
  * 动态媒体接入控制:随机接入
* 以太网的两个标准:
  * DIX Ethernet V2
  * IEEE 802.3标准
* 曼彻斯特编码
* CSMA/CD协议
  * 带碰撞检测,载波监听,多路访问
  * 要点:准备发送,检测信道碰撞,停止,人工干预
* 网络适配器(网卡)作用
  1. 拆装帧
  2. 差错检验
  3. 编码,译码
  4. 串并行转换
  5. 缓存数据
  6. 实现以太网的协议
* 集线器:对电信号放大,传输更远
* MAC层的硬件地址:48位标识符(12个16进制数`-`分隔表示),前24位是组织唯一标识符,后24位是扩展唯一标识符,保证不相同即可
* MAC的帧格式:
  1. MAC帧格式有两种,DIX Ethernet V2和IEEE802.3两种,区别在于后者的第三个字段为长度字段,如果长度与长度字段不同或帧长不是字节整数倍无效,一般使用后者格式
  2. 在尾部存在FCS冗余检测码检验差错
  3. 最短发送时间间隔为发送9.6bit的时间,约9.6ms(传统以太网10Mbit/S)
  4. 当MAC帧到达物理层会在前面增加前同步码和帧界定符

  |6(字节)|6|2|46~1500|4|
  |---|---|---|---|---|
  |目的地址|源地址|类型|IP数据报数据|FCS|

## 以太网

* 拓展的以太网
  * 在物理层拓展:使用光纤和集线器扩大范围
  * 在数据链路层扩展:使用网桥分隔数据链路层,减少信号干扰,能够学习记录地址对应的端口位置,记录到转发表中,根据发送站和目标站的位置进行决策,之后拓展成集线器和交换机(交换式集线器),可以看成多端口网桥,集线器一次只允许同时一台发送数据,交换机允许多台,它们也会记录交换表,并使用内容寻址存储器,比网桥快得多
* 总线以太网(集线器)和星形以太网(交换机):总线以太网成为星形以太网的首选拓扑,他们工作层次不同,工作方式不同,工作原理不同
* 虚拟局域网VLAN也称广播域:由一些局域网段构成的与物理位置无关的逻辑组,而这些网段具有某些共同需求
* 将这些划为相同广播域,分配相同的VID,发送广播只影响当前广播域中的接口,减少交换机中端口太多产生的干扰,虚拟地址可由IP地址,MAC地址等生成
* VLAN帧格式`定义于IEEE802.3ac`:在MAC帧格式的长度字段前增加4B个标识符,标识802.1Q帧(2字节展示0X8100标记类型,2字节标记控制信息),以太网的最大帧长度因此增长到1522字节
* 高速以太网(速度大于100Mbit/S)规范
  1. 100BASE-T代表星形拓扑以太网,能够传送10或100Mbit/s
  2. 100BASE-F使用两根光纤,100Mbit/s
  3. 吉比特互联网使用光纤,千兆网络
  4. 10比特,不在使用铜线,
* 高速以太网的发展证明以太网是可拓展的,灵活的(多媒体,全半双工,共享/交换),易于安装的
* 使用以太网接入互联网:由于互联网两个协议的成功,人们想把PPP和以太网协议类型起来,即把PPP帧放到以太网帧中传输,建立网络连接(PPPOE)
